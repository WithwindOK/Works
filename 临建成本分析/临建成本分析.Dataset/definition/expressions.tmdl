expression 截止日期 = #datetime(2023, 10, 1, 0, 0, 0) meta [IsParameterQuery=true, Type="DateTime", IsParameterQueryRequired=true]
	lineageTag: 02388c94-a1ba-43b6-a0e2-afad49b00212
	queryGroup: 成本分析\参数

	annotation PBI_ResultType = DateTime

expression X5 =
		let
		    源 = Oracle.Database("172.16.8.76/oracledb", [HierarchicalNavigation=true])
		in
		    源
	lineageTag: 9fd7841e-611c-4770-a05f-8a65304cad59
	queryGroup: 成本分析\辅助表

	annotation PBI_ResultType = Table

	annotation PBI_NavigationStepName = 导航

expression MD_XIANGMUXINXI =
		let
		    源 = X5,
		    MD = 源{[Schema="MD"]}[Data],
		    MD_XIANGMUXINXI = MD{[Name="MD_XIANGMUXINXI"]}[Data],
		    重命名的列 = Table.RenameColumns(MD_XIANGMUXINXI,fx_List_生成字段更名列表("MD","MD_XIANGMUXINXI")),
		    #"停止折叠（取消后续会出错）" = Table.StopFolding(重命名的列)
		in
		    #"停止折叠（取消后续会出错）"
	lineageTag: 036b5c0b-706f-4bb4-875d-e9c32754d3a1
	queryGroup: 成本分析\辅助表

	annotation PBI_ResultType = Table

expression fx_List_生成字段更名列表 =
		let
		    源 = (OWNER as text,TABLE_NAME as text) as list => let
		        源 =  X5,
		        源1=Value.NativeQuery(源,"select COLUMN_NAME,COMMENTS from all_col_comments where OWNER = '" & OWNER &"' and TABLE_NAME = '" & TABLE_NAME & "'"),
		        替换的值 = Table.ReplaceValue(源1,null, each [COLUMN_NAME],Replacer.ReplaceValue,{"COMMENTS"}),
		        更改的类型 = Table.TransformColumnTypes(替换的值,{{"COMMENTS", type text}}),
		        删除的副本 = Table.Distinct(更改的类型, {"COMMENTS"}),
		        缩短说明字段长度=Table.TransformColumns(删除的副本, {{"COMMENTS", each Text.Start(_,15), type text}}),
		        自定义1 = List.Zip({缩短说明字段长度[COLUMN_NAME],缩短说明字段长度[COMMENTS]})
		    in
		        自定义1
		in
		    源
	lineageTag: a786b248-ba79-45d2-9c1b-585bf3407b2a
	queryGroup: 成本分析\辅助表

	annotation PBI_ResultType = Function

expression 项目信息 =
		let
		    源 = MD_XIANGMUXINXI,
		    计算责任体 = Table.AddColumn(源, "责任体", each if [京内外分布] = "国际" then "海外" else if [厂房事业部] <> null then [厂房事业部] else if [直管机构] <> "公司" then [直管机构] else if [城市公司] <> null then [城市公司] else "公司直营", type text),
		    #"筛选的行（去掉纯机电/基础设施项目）" = Table.SelectRows(计算责任体, each [投标管理部门] = "营销管理中心"),
		    重命名的列1 = Table.RenameColumns(#"筛选的行（去掉纯机电/基础设施项目）",{{"fYWBK", "业务板块"}}),
		    删除的其他列 = Table.SelectColumns(重命名的列1,{"项目编码", "项目名称", "专业分类", "项目性质", "签约单位", "工程类别[一级]", "工程类别[二级]", "经营类型", "业务板块", "投标管理部门", "股份财务一体化项目编码", "股份一体化利润中心编码", "责任体"})
		in
		    删除的其他列
	lineageTag: 37a44e63-c11c-4c96-a039-1932ca7bf3c9
	queryGroup: 成本分析\辅助表

	annotation PBI_ResultType = Table

expression 临时设施标准合同库 =
		let
		    源 = X5,
		    GSPM = 源{[Schema="GSPM"]}[Data],
		    GSPM_CHUSHIMUBIAOCBCB1 = GSPM{[Name="GSPM_BIAOZHUNHETONG2020"]}[Data],
		    筛选的行 = Table.SelectRows(GSPM_CHUSHIMUBIAOCBCB1, each ([FDYSDZB] = "临时设施费")),
		    删除的其他列 = Table.SelectColumns(筛选的行,{"FBIAOZHUNHETONGBH"}),
		    删除的副本 = Table.Distinct(删除的其他列, {"FBIAOZHUNHETONGBH"})
		in
		    删除的副本
	lineageTag: 7cbef4fc-5bf4-4ada-99eb-3d47f1ed5c96
	queryGroup: 成本分析\辅助表

	annotation PBI_ResultType = Table

	annotation PBI_NavigationStepName = 导航

expression 额外标准合同 =
		let
		    源 = Table.FromRows(Json.Document(Binary.Decompress(Binary.FromText("i45WcorydtI1NDRRitWBcQzMlWJjAQ==", BinaryEncoding.Base64), Compression.Deflate)), let _t = ((type nullable text) meta [Serialized.Text = true]) in type table [FBIAOZHUNHETONGBH = _t])
		in
		    源
	lineageTag: eccf85bb-60c6-462e-ad97-01ddc11d9cf8
	queryGroup: 成本分析\辅助表

	annotation PBI_ResultType = Table

expression 内部交易 =
		let
		    源 = Table.FromRows(Json.Document(Binary.Decompress(Binary.FromText("lVFNCoJgFLyL68ADiXcp0sQfzDYapVJmZKEWIWlKeZh836e3SP1auElr94aZecy8xzAUjfQHxHuccTgTkHqqYRndaayewZkWuYUkt8YUO/oqRbqAlirhBqQQisB7P0mLJELGrQyfBPdudc3KiAgHjg3SZsBQWXbXg/lDXaA3TKogf4s0v8y1oTAzv1p7EOz+yAPmpUik13jSDjIp3cAsxcECi0e84sg9Pg9pBb0b4yuESkN4Msyl2gCu0Pkm+wY=", BinaryEncoding.Base64), Compression.Deflate)), let _t = ((type nullable text) meta [Serialized.Text = true]) in type table [商务科目 = _t]),
		    已添加自定义 = Table.AddColumn(源, "自定义", each 额外标准合同),
		    #"展开的“自定义”" = Table.ExpandTableColumn(已添加自定义, "自定义", {"FBIAOZHUNHETONGBH"}, {"FBIAOZHUNHETONGBH"}),
		    重命名的列 = Table.RenameColumns(#"展开的“自定义”",{{"FBIAOZHUNHETONGBH", "标准合同编号"}}),
		    更改的类型 = Table.TransformColumnTypes(重命名的列,{{"标准合同编号", type text}})
		in
		    更改的类型
	lineageTag: eee29949-52ce-4c73-a89e-5345e3bcdee6
	queryGroup: 成本分析\辅助表

	annotation PBI_ResultType = Table

expression GSPM_CHUSHIMUBIAOCBZB（初始目标成本主表） =
		let
		    源 = X5,
		    GSPM = 源{[Schema="GSPM"]}[Data],
		    GSPM_CHUSHIMUBIAOCBZB1 = GSPM{[Name="GSPM_CHUSHIMUBIAOCBZB"]}[Data],
		    #"筛选的行（完成单据）" = Table.SelectRows(GSPM_CHUSHIMUBIAOCBZB1, each ([FPINGSHENZHUANGTAI] = "已完成")),
		    #"筛选的行（截止日期）" = Table.SelectRows(#"筛选的行（完成单据）", each [FPINGSHENJIESHURIQI] < 截止日期),
		    删除的其他列 = Table.SelectColumns(#"筛选的行（截止日期）",{"FID", "FXIANGMUMINGCHENG", "FXIANGMUBIANMA", "FJIANZHUMIANJI", "FHETONGE", "FMBCBZSR", "FMBCBZZC"}),
		    重命名的列 = Table.RenameColumns(删除的其他列,{{"FHETONGE", "累计合同额"}, {"FMBCBZSR", "累计自施收入"}, {"FMBCBZZC", "累计目标成本"}, {"FJIANZHUMIANJI", "建筑面积"}, {"FXIANGMUBIANMA", "项目编码"}, {"FXIANGMUMINGCHENG", "项目名称"}})
		in
		    重命名的列
	lineageTag: cdacd68d-acd6-4e68-a7b8-6c387de8d94b
	queryGroup: 成本分析\初始

	annotation PBI_ResultType = Table

	annotation PBI_NavigationStepName = 导航

expression GSPM_CHUSHIMUBIAOCBFJ（初始目标成本分解从表） =
		let
		    源 = X5,
		    GSPM = 源{[Schema="GSPM"]}[Data],
		    GSPM_CHUSHIMUBIAOCBCB1 = GSPM{[Name="GSPM_CHUSHIMUBIAOCBFJ"]}[Data],
		    删除的其他列 = Table.SelectColumns(GSPM_CHUSHIMUBIAOCBCB1,{"FZBID", "FBIAOZHUNHETONGCODE", "FSRJE", "FCSMBCBCBHJ"}),
		    重命名的列 = Table.RenameColumns(删除的其他列,{{"FSRJE", "临设费收入（累计）"}, {"FCSMBCBCBHJ", "临设费目标成本（累计）"}}),
		    #"合并的查询（通过标准合同取临时设施）" = Table.NestedJoin(重命名的列, {"FBIAOZHUNHETONGCODE"}, 临时设施标准合同库, {"FBIAOZHUNHETONGBH"}, "临时设施标准合同库", JoinKind.Inner),
		    删除的其他列1 = Table.SelectColumns(#"合并的查询（通过标准合同取临时设施）",{"FZBID", "临设费收入（累计）", "临设费目标成本（累计）"}),
		    #"追加的查询（追加排除部分）" = Table.Combine({删除的其他列1, #"GSPM_CHUSHIMUBIAOCBFJ（初始目标成本分解从表排除部分）)"}),
		    分组的行 = Table.Group(#"追加的查询（追加排除部分）", {"FZBID"}, {{"临设费收入（累计）", each List.Sum([#"临设费收入（累计）"]), type nullable number}, {"临设费目标成本（累计）", each List.Sum([#"临设费目标成本（累计）"]), type nullable number}})
		in
		    分组的行
	lineageTag: 7fa00560-f849-47f1-b1be-ea6f3d4f395f
	queryGroup: 成本分析\初始

	annotation PBI_ResultType = Exception

	annotation PBI_NavigationStepName = 导航

expression GSPM_CHUSHIMUBIAOCBFJ（初始目标成本分解从表排除部分）) =
		let
		    源 = X5,
		    GSPM = 源{[Schema="GSPM"]}[Data],
		    GSPM_CHUSHIMUBIAOCBCB1 = GSPM{[Name="GSPM_CHUSHIMUBIAOCBFJ"]}[Data],
		    删除的其他列 = Table.SelectColumns(GSPM_CHUSHIMUBIAOCBCB1,{"FZBID", "FBIAOZHUNHETONGCODE", "FSRJE", "FCSMBCBCBHJ", "FSHANGWUKEMUFNAME"}),
		    重命名的列 = Table.RenameColumns(删除的其他列,{{"FSRJE", "临设费收入（累计）"}, {"FCSMBCBCBHJ", "临设费目标成本（累计）"}}),
		    #"合并的查询（通过商务科目、标准合同取临时设施）" = Table.NestedJoin(重命名的列, {"FSHANGWUKEMUFNAME", "FBIAOZHUNHETONGCODE"}, 内部交易, {"商务科目", "标准合同编号"}, "临时设施标准合同库", JoinKind.Inner),
		    删除的其他列1 = Table.SelectColumns(#"合并的查询（通过商务科目、标准合同取临时设施）",{"FZBID", "临设费收入（累计）", "临设费目标成本（累计）"})
		in
		    删除的其他列1
	lineageTag: 00e192e5-9b81-4826-bcff-cd413fa9f064
	queryGroup: 成本分析\初始

	annotation PBI_ResultType = Exception

	annotation PBI_NavigationStepName = 导航

expression 初始目标成本 =
		let
		    源 = #"GSPM_CHUSHIMUBIAOCBZB（初始目标成本主表）",
		    #"合并的查询（排除有调整的项目）" = Table.NestedJoin(源, {"项目编码"}, #"GSPM_TZMUBIAOCBZB（调整目标成本主表）", {"项目编码"}, "调整目标成本主表", JoinKind.LeftAnti),
		    删除的列 = Table.RemoveColumns(#"合并的查询（排除有调整的项目）",{"调整目标成本主表"}),
		    合并的查询1 = Table.NestedJoin(删除的列, {"FID"}, #"GSPM_CHUSHIMUBIAOCBFJ（初始目标成本分解从表）", {"FZBID"}, "初始目标成本从表", JoinKind.LeftOuter),
		    #"展开的“初始目标成本从表”" = Table.ExpandTableColumn(合并的查询1, "初始目标成本从表", {"临设费收入（累计）", "临设费目标成本（累计）"}, {"临设费收入（累计）", "临设费目标成本（累计）"})
		in
		    #"展开的“初始目标成本从表”"
	lineageTag: ffe6caf7-5ac3-4e42-bf5a-7795597b450f
	queryGroup: 成本分析\初始

	annotation PBI_ResultType = Table

expression GSPM_TZMUBIAOCBZB（调整目标成本主表） =
		let
		    源 = X5,
		    GSPM = 源{[Schema="GSPM"]}[Data],
		    GSPM_TZMUBIAOCBZB1 = GSPM{[Name="GSPM_TZMUBIAOCBZB"]}[Data],
		    #"筛选的行(完成单据）" = Table.SelectRows(GSPM_TZMUBIAOCBZB1, each ([FPINGSHENZHUANGTAI] = "已完成")),
		    #"筛选的行（截止日期）" = Table.SelectRows(#"筛选的行(完成单据）", each [FPINGSHENJIESHURIQI] < 截止日期),
		    删除的其他列 = Table.SelectColumns(#"筛选的行（截止日期）",{"FID", "FXIANGMUMINGCHENG", "FXIANGMUBIANMA", "FJIANZHUMIANJI", "FHETONGE", "FSR", "FMBCBHBC", "SCREATETIME"}),
		    重命名的列1 = Table.RenameColumns(删除的其他列,{{"FHETONGE", "累计合同额"}, {"FSR", "累计收入"}, {"FMBCBHBC", "累计目标成本"}, {"FXIANGMUMINGCHENG", "项目名称"}, {"FXIANGMUBIANMA", "项目编码"}, {"FJIANZHUMIANJI", "建筑面积"}}),
		    排序的行 = Table.Sort(重命名的列1,{{"项目编码", Order.Ascending}, {"SCREATETIME", Order.Descending}}),
		    已添加索引 = Table.AddIndexColumn(排序的行, "索引", 0, 1, Int64.Type),
		    删除的副本 = Table.Distinct(已添加索引, {"项目编码"}),
		    删除的列 = Table.RemoveColumns(删除的副本,{"SCREATETIME", "索引"}),
		    重命名的列 = Table.RenameColumns(删除的列,{{"累计收入", "累计自施收入"}})
		in
		    重命名的列
	lineageTag: 8f8a356b-5bc0-4ec3-bcb5-b076889364ca
	queryGroup: 成本分析\调整

	annotation PBI_ResultType = Table

expression GSPM_TZMUBIAOCBFJ（调整目标成本分解从表） =
		let
		    源 = X5,
		    GSPM = 源{[Schema="GSPM"]}[Data],
		    GSPM_CBFENXIPD1 = GSPM{[Name="GSPM_TZMUBIAOCBFJ"]}[Data],
		    删除的其他列 = Table.SelectColumns(GSPM_CBFENXIPD1,{"FZBID", "FBIAOZHUNHETONGCODE", "FSRJE", "FCSMBCBCBHJ"}),
		    重命名的列 = Table.RenameColumns(删除的其他列,{{"FSRJE", "临设费收入（累计）"}, {"FCSMBCBCBHJ", "临设费目标成本（累计）"}}),
		    #"合并的查询（通过标准合同取临设）" = Table.NestedJoin(重命名的列, {"FBIAOZHUNHETONGCODE"}, 临时设施标准合同库, {"FBIAOZHUNHETONGBH"}, "临时设施标准合同库", JoinKind.Inner),
		    删除的其他列1 = Table.SelectColumns(#"合并的查询（通过标准合同取临设）",{"FZBID", "临设费收入（累计）", "临设费目标成本（累计）"}),
		    #"追加的查询（醉驾排除部分）" = Table.Combine({删除的其他列1, #"GSPM_TZMUBIAOCBFJ（调整目标成本分解从表排除部分）"}),
		    分组的行 = Table.Group(#"追加的查询（醉驾排除部分）", {"FZBID"}, {{"临设费收入（累计）", each List.Sum([#"临设费收入（累计）"]), type nullable number}, {"临设费目标成本（累计）", each List.Sum([#"临设费目标成本（累计）"]), type nullable number}})
		in
		    分组的行
	lineageTag: 9c5aa00e-69af-49ba-b61c-e292fbd34cdf
	queryGroup: 成本分析\调整

	annotation PBI_ResultType = Table

expression GSPM_TZMUBIAOCBFJ（调整目标成本分解从表排除部分） =
		let
		    源 = X5,
		    GSPM = 源{[Schema="GSPM"]}[Data],
		    GSPM_CBFENXIPD1 = GSPM{[Name="GSPM_TZMUBIAOCBFJ"]}[Data],
		    删除的其他列 = Table.SelectColumns(GSPM_CBFENXIPD1,{"FZBID", "FBIAOZHUNHETONGCODE", "FSRJE", "FCSMBCBCBHJ", "FSHANGWUKEMUFNAME"}),
		    重命名的列 = Table.RenameColumns(删除的其他列,{{"FSRJE", "临设费收入（累计）"}, {"FCSMBCBCBHJ", "临设费目标成本（累计）"}}),
		    #"合并的查询（通过标准合同取临设）" = Table.NestedJoin(重命名的列, {"FSHANGWUKEMUFNAME", "FBIAOZHUNHETONGCODE"}, 内部交易, {"商务科目", "标准合同编号"}, "临时设施标准合同库", JoinKind.Inner),
		    删除的其他列1 = Table.SelectColumns(#"合并的查询（通过标准合同取临设）",{"FZBID", "临设费收入（累计）", "临设费目标成本（累计）"})
		in
		    删除的其他列1
	lineageTag: a0cb0752-7287-48e1-bcda-32d1e1e49d50
	queryGroup: 成本分析\调整

	annotation PBI_ResultType = Table

expression 调整目标成本 =
		let
		    源 = Table.NestedJoin(#"GSPM_TZMUBIAOCBZB（调整目标成本主表）", {"FID"}, #"GSPM_TZMUBIAOCBFJ（调整目标成本分解从表）", {"FZBID"}, "调整从表", JoinKind.LeftOuter),
		    #"展开的“调整从表”" = Table.ExpandTableColumn(源, "调整从表", {"临设费收入（累计）", "临设费目标成本（累计）"}, {"临设费收入（累计）", "临设费目标成本（累计）"})
		in
		    #"展开的“调整从表”"
	lineageTag: 6ad45d28-aafb-4847-acf6-e52570298b23
	queryGroup: 成本分析\调整

	annotation PBI_ResultType = Table

